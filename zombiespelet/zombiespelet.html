<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Main game</title>
</head>
<body>
    <script src="simple.js">
        //Ladda ljudeffekter som kommer användas
        preloadSound("sfx/player_ouch.mp3"); 
        preloadSound("sfx/sword_woosh.wav");
        preloadSound("sfx/fire_sword_woosh.mp3");
        preloadSound("sfx/med_kit.mp3");
        
        //Zombie variables
        var zombies = [];         //Lista för att hålla zombies
        var numberOfZombies = 25; //Antalet zombies som kommer skapas
        var zombieSpeedMax = 3;   //Max speed zombies kan ha
        var zombieSpeedMin = 1;   //min speed zombies kan ha
        var i = 0;
        while (i < numberOfZombies) //While loop som pushar ett antal zombies in i en lista
        {
            zombies.push({  x: random(totalWidth), y: random(totalHeight) / 2, speed: random(zombieSpeedMin, zombieSpeedMax) , health: 100 , alive: true});
            i++;
        }
        
        //Player one variables
        var player1Speed = 13;
        var player1 = {x: totalWidth / 2 , y: totalHeight/2 , speed: player1Speed, health: 100, points: 0};

        //Medkit variables
        var medKit = {x: 470 , y: 100, alive: true};

        //Regular sword variable
        var swordAlive = true;
        var swordTime = 0;

        //Fire sword powerup variables
        var fireSword = {x: random(100, totalWidth-100) , y: random(100, totalHeight-100), alive: true, equipped: false};

        //Main update function
        function update()
        {
            clearScreen();

            //Drawing the map  
            fill(mixColor(40, 0, 0)); //Fill colour
            
            rectangle(400, 0, 50,200, "brown");     //verikal rektangel top right
            rectangle(400, 200, 200,50, "brown");   //horisontel rektangel top right
            //Collision för top right rektangels för player 1
            if (player1.x + 60 > 400 && player1.x + 60 < 450  && player1.y < 200) {player1.x -= player1.speed;}                         //Collision left side
            if (player1.x > 400 && player1.x  < 450  && player1.y < 200) {player1.x += player1.speed;}                                  //Collision inner right side
            if (player1.x > 400 && player1.x  < 600  && player1.y < 200 && player1.y +60 > 150) {player1.x += player1.speed;}           //Collision right side
            if (player1.y < 250 && player1.y > 200 && player1.x +60 > 400 && player1.x < 600 ) {player1.y += player1.speed;}            //Collision bottom side
            if (player1.y + 120 < 250 && player1.y + 120 > 200 && player1.x > 400 && player1.x < 600 ) {player1.y -= player1.speed;}    //Collision top

            //Outer Screen Bounds for player 1
            if (player1.x + 50 > totalWidth) {player1.x -= player1.speed;}  //left x-bounds
            if (player1.x < 0) {player1.x += player1.speed;}                //right x-bounds
            if (player1.y + 90 > totalHeight) {player1.y -= player1.speed;} //bottom y-bounds
            if (player1.y + 20 < 0) {player1.y += player1.speed;}           //top y-bounds

            //Med kit powerup
            if (medKit.alive) //Rita ut medkit ifall medkit.alive är sant
            {
                picture(medKit.x, medKit.y, "img/med-kit.png");
            }
            if (distance(player1 , medKit) < 60 && medKit.alive) //Om spelaren går över medkit ges den full health och medkit slutar ritas och ut ge health
            {
                playSound("sfx/med_kit.mp3", 1);
                player1.health = 100;
                medKit.alive = false;
            }
            
            //firesword powerup
            if (player1.points >= 25 && fireSword.alive)
            {
                picture(fireSword.x, fireSword.y, "img/fire_sword_left.png");
                if (distance(fireSword, player1) < 60)
                {
                    playSound("sfx/med_kit.mp3",1);
                    fireSword.alive = false;
                    swordAlive = false;
                    fireSword.equipped = true;
                }
            }


            //Player one controls
            if (keyboard.w) {player1.y -= player1.speed;}   //Make character go up
            if (keyboard.s) {player1.y += player1.speed;}   //Make character go down
            if (keyboard.a) {player1.x -= player1.speed;}   //Make character go left
            if (keyboard.d)                                 //Make character go right
            {
                player1.x += player1.speed;      

                //Rita player 1 riktad åt höger om D trycks ned
                picture(player1.x, player1.y, "img/player1_right.png")

                //Default sword
                if(swordAlive)
                {
                    
                    if (keyboard.space && swordTime < 5)
                    {
                        picture(player1.x + 50 , player1.y+75, "img/sword_woosh_right.png");
                        playSound("sfx/sword_woosh.wav", 0.2);
                        swordTime ++;
                    }
                    else if (keyboard.space)
                    {
                        swordTime ++;
                        picture(player1.x + 50, player1.y+43, "img/sword_right.png");
                    }
                    else
                    {
                        swordTime = 0;
                        picture(player1.x + 50, player1.y+43, "img/sword_right.png");
                    }
                }

                //Fire Sword
                if(fireSword.equipped)
                {
                    if (keyboard.space && swordTime < 5)
                    {
                        picture(player1.x + 50 , player1.y+75, "img/fire_sword_woosh_right.png");
                        playSound("sfx/fire_sword_woosh.mp3", 1);
                        swordTime++;
                    }
                    else if (keyboard.space)
                    {
                        swordTime ++;
                        picture(player1.x + 50, player1.y+43, "img/fire_sword_right.png");
                    }
                    else
                    {
                        swordTime = 0;
                        picture(player1.x + 50, player1.y+43, "img/fire_sword_right.png");
                    }
                }
            }   
            else 
            {
                //Rita player 1 riktad åt vänster om D inte trycks ned
                picture(player1.x, player1.y, "img/player1_left.png");
                
                //Default Sword
                if (swordAlive )
                {
                    if (keyboard.space && swordTime < 5)
                    {
                        picture(player1.x-50, player1.y+75, "img/sword_woosh_left.png");
                        playSound("sfx/sword_woosh.wav", 0.2);
                        swordTime++;
                    }
                    else if (keyboard.space)
                    {
                        swordTime++;
                        picture(player1.x-50, player1.y+43, "img/sword_left.png");
                    }
                    else
                    {
                        swordTime = 0;
                        picture(player1.x-50, player1.y+43, "img/sword_left.png");
                    }
                }

                //Fire Sword
                if (fireSword.equipped)
                {
                    if (keyboard.space && swordTime < 5)
                    {
                        picture(player1.x-50, player1.y+75, "img/fire_sword_woosh_left.png");
                        playSound("sfx/fire_sword_woosh.mp3", 1);
                        swordTime++;
                    }
                    else if (keyboard.space)
                    {
                        swordTime++;
                        picture(player1.x-50, player1.y+43, "img/fire_sword_left.png");
                    }
                    else
                    {
                        swordTime = 0;
                        picture(player1.x-50, player1.y+43, "img/fire_sword_left.png");
                    }
                }
            }

            //Player 1 Health-bar
            rectangle(player1.x - 20, player1.y - 20, 100, 10, "grey");             //Health bar grey background
            rectangle(player1.x - 20, player1.y - 20, player1.health, 10, "green"); //Green health bar

            //Player 1 kills
            text(totalWidth - 450, 70, 30, "Player 1 kills: " + player1.points, "yellow");  

            
            

            var i = 0;
            while (i < numberOfZombies)
            {
                
                
                var zombie = zombies[i];
            
                if (zombie.alive) //allt inom if loopen ska endast ske ifall zombien i fråga är vid liv
                {
                    picture(zombie.x, zombie.y, "img/zombie.png"); //Bild på zombie som ritas ut när zombien är vid liv

                    if (swordAlive)//If loop) för att spelaren ska skada zombie med vanligt svärd
                    {
                    
                        if (distance(player1 , zombie) < 130  && keyboard.space && keyboard.d && zombie.x > player1.x)
                        {
                            zombie.health -= 5;
                        }
                        if (distance(player1 , zombie) < 130  && keyboard.space &&  zombie.x < player1.x)
                        {
                            zombie.health -= 5;
                        }
                    }
                    if (fireSword.equipped)//If loop) för att spelaren ska skada zombie med vanligt svärd
                    {
                    
                        if (distance(player1 , zombie) < 130  && keyboard.space && keyboard.d && zombie.x > player1.x)
                        {
                            zombie.health -= 15;
                        }
                        if (distance(player1 , zombie) < 130  && keyboard.space &&  zombie.x < player1.x)
                        {
                            zombie.health -= 15;
                        }
                    }

                    if (zombie.health <= 0) //If loop för att zombie ska dö
                    {
                        zombie.alive = false; //Zombie är inte längre vid liv
                        player1.points += 1;  //Spelaren får en poäng för att ha dödat zombien
                            
                    }

                    //Zombie movements
                    if (zombie.x < player1.x){zombie.x += zombie.speed;}    //if the player1 is to the right of the zombie they will move to the right
                    else {zombie.x -= zombie.speed;}                        //if not they will move to the left
                    if (zombie.y < player1.y){zombie.y += zombie.speed;}    //if the player1 is below the zombie they will move down
                    else {zombie.y -= zombie.speed;}                        //if not they will move up

                    //Zombie Health-bar
                    rectangle(zombie.x - 20, zombie.y - 20, 100, 10, "grey");               //Health bar grey background
                    rectangle(zombie.x - 20, zombie.y - 20, zombie.health, 10, "green");    //Green health bar with zombie health as length

                        

                    //If loopSound() för att zombies ska skada spelaren när spelaren kommer för nära
                    if (distance(player1 , zombie) < 35)
                    {
                        player1.health -= 1;
                            
                    }
            }
                
                //Game over när player 1 health är noll eller mindre
                if (player1.health <= 0)
                {
                    playSound("sfx/player_ouch.mp3", 1);                                    //Ouch sound effect
                    text(totalWidth / 2 - 210, totalHeight/2, 60, "GAME OVER", "yellow");   //Game over text
                    stopUpdate();                                                           //Avslutar update funktionen
                }

                
                i++;
            }
        }

    </script>
<!--<img width="500px" src="https://thumbs.dreamstime.com/b/cartoon-racing-map-game-49708152.jpg">-->

</body>
</html>